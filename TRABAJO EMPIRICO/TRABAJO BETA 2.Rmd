---
title: "Entrega 1: Creación de un Estimador de la media poblacional"
author: "Daniel Aramburu, Guillermo Palomo, Jorge Salas y Marc Pastor"
date: "9 de Octubre de 2020"
output: pdf_document
---


# 1. Introducción
El objetivo de este trabajo es crear un Estadístico para estimar la media poblacional de una distribución continua determinada (que no sea la Distribución Normal ni la Exponencial) y comparar su rendimiento con la media muestral (que es el estadístico más usado para aproximar la media poblacional). En nuestro caso hemos optado por la distribución Beta (con alpha y beta = 2) debido a que su función de densidad es simétrica y centrada, y nos parece que es sencillo encontrar un Estadístico fiable para aproximar su media poblacional. 


# 2. Distribución Beta
La Distribución Beta es una distribución continua que depende de dos parámetros (alpha y beta) y que toma valores en el intervalo [0,1]. Debido a que solo está definida en [0,1] es una distribución muy usada para modelizar la probabilidad de que ocurra un evento, aunque también es usada para describir datos empíricos (debido a la variedad de formas que puede adoptar en función de los valores que tomen sus parámetros) y para modelar la fiabilidad de un sistema. Su función de densidad es distinta de cero solo cuando 0 < x < 1 y es la siguiente:
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "175px", fig.align = "center"}
library(knitr)
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/FUNCIÓN DE DENSIDAD/DENSIDAD1.jpg")
```

También se puede escribir como:
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "175px", fig.align = "center"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/FUNCIÓN DE DENSIDAD/funciondensidad2.jpg")
```

Dónde la función Beta es la siguiente:
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "263px", fig.align = "center"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/FUNCIÓN DE DENSIDAD/funcionbeta.jpg")
```

\newpage
### Propiedades de la función Beta
La función beta cumple las siguientes propiedades (las usaremos para encontrar su función generadora de momentos, etc):
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "400px", fig.align = "center"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/FUNCIÓN DE DENSIDAD/propiedadesfuncionbeta.jpg")
```


## 2.0 Forma de la distribución Beta
Esta distribución adopta formas muy diversas, en función de los valores de sus parámetros, por ello se utiliza mucho para modelar datos de manera empírica (es decir, observando la forma de la distribución de los datos, se intenta aproximar por la distribución beta con la forma más parecida)
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "400px", fig.align = "center"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/Beta_distribution.png")
```

\newpage
## 2.1 Momentos
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "260px", fig.align = "center"}
library(knitr)
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/MOMENTOS/momentos.jpg")
```

## 2.2 Función Generadora de Momentos
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "350px", fig.align = "center", out.height = "350px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/LATEX Y FÓRMULAS/FUNCIÓN GENERADORA DE MOMENTOS/funciongeneradorabeta.jpg")
```

\newpage
# 3. Creación del Estadístico para estimar la Media Poblacional
En primer lugar hemos creado la función *muestreo*. Esta función es la base de toda la práctica, ya que nos permite crear muestras aleatorias, calcular nuestro Estadístico, y la media muestral en cada una de esas 40 muestras, etc. 
```{r, message = FALSE, warning = FALSE}
library(tidyverse)
library(e1071)
library(moments)
library(gt)
library(ggpubr)
library(ggplotify)
library(grid)

muestreo <- function(alpha, beta){
        lista <- list()
        tabla_muestras <- matrix(ncol = 40, nrow = 10) %>% as.data.frame() 
        lista[[6]] <- matrix(ncol = 40, nrow = 1) %>% as.data.frame()
        media_poblacional <- alpha / (alpha + beta)
        varianza_poblacional <- alpha * beta / (((alpha + beta) ^ 2 ) * (alpha + beta + 1))
        for(j in 1:40){
                set.seed(j)
                tabla_muestras[, j] <- rbeta(10, shape1 = alpha, shape2 = beta)
                colnames(tabla_muestras)[j] <- as.numeric(gsub("V", "", 
                                                               colnames(tabla_muestras)[j]))
                colnames(lista[[6]])[j] <-  as.numeric(gsub("V", "", 
                                                            colnames(tabla_muestras)[j]))
                lista[[6]][, j] <- 0.5*(quantile(tabla_muestras[, j], 
                                                 probs = c(0.6)) + 
                                                quantile(tabla_muestras[, j], 
                                                         probs = c(0.4)))
        }
        lista[[1]] <- tabla_muestras
        lista[[2]] <- media_poblacional
        lista[[3]] <- varianza_poblacional
        lista[[4]] <- data.frame(Muestra = names(colMeans(tabla_muestras)), 
                                 mediamuestral = unname(colMeans(tabla_muestras))) 
        lista[[5]] <- data.frame(Estimador = "Media Muestral", 
                                 Media = mean(lista[[4]][, 2]),
                                 Mediana = median(lista[[4]][, 2]),
                                 SD = sd(lista[[4]][, 2]), 
                                 IQR = IQR(lista[[4]][, 2]), 
                                 MAD = mad(lista[[4]][, 2]), 
                                 Curtosis = moments::kurtosis(lista[[4]][, 2]), 
                                 Asimetría = e1071::skewness(lista[[4]][, 2]))
        lista[[6]] <- gather(as.data.frame(lista[[6]])) 
        colnames(lista[[6]]) <- c("Muestra", "Estadístico")
        lista[[7]] <- data.frame(Estimador = "Estadístico",
                                 Media = mean(lista[[6]][, 2]),
                                 Mediana = median(lista[[6]][, 2]),
                                 SD = sd(lista[[6]][, 2]), 
                                 IQR = IQR(lista[[6]][, 2]), 
                                 MAD = mad(lista[[6]][, 2]), 
                                 Curtosis = moments::kurtosis(lista[[6]][, 2]), 
                                 Asimetría = e1071::skewness(lista[[6]][, 2]))
        lista[[8]] <- rbind(lista[[5]], lista[[7]])
        names(lista) <- c("tabla_muestras", "media_poblacional", 
                          "varianza_poblacional", "media_muestral", 
                          "medidas_media_muestral", "estadistico", 
                          "medidas_estadistico", "tabla_comparacion")
        lista
}

resultados <- muestreo(alpha = 2, beta = 2)

datosgrafico <- inner_join(resultados$media_muestral , resultados$estadistico)
```

\newpage
# 4. Evaluación de nuestro Estadístico
## 4.1 Tabla de Medidas 

```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "450px", fig.align = "center", out.height = "400px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/MEDIDAS/medidasestadistico2.png")
```

## 4.2 Histogramas
```{r, message = FALSE, warning = FALSE, fig.align = "center", fig.width = 4, fig.height = 4}
grafico_estadistico_histogram_density <- ggplot(data = datosgrafico, aes(x = Estadístico)) + 
        geom_histogram(fill = "lightblue", binwidth = 0.05, color = "black") + 
        geom_density(color = "blue", size = 0.75) +
        ggtitle("Histograma de nuestro Estadístico") + 
        geom_vline(aes(xintercept = resultados[[7]]$Media, col = "Estimador"), linetype = "dashed", size = 1) +
        geom_vline(aes(xintercept = resultados$media_poblacional,  col = "Media Poblacional"), size = 1) + 
        scale_color_manual(name = "", values = c("Media Poblacional" = "black", Estimador = "red")) + 
        xlab("x") + ylab("f(x)") +
        theme(legend.position = "top",
              legend.text = element_text(size = 14),
              axis.text.x = element_text(size = 12),
              axis.text.y = element_text(size = 12),
              axis.title = element_text(size = 13, face = "bold"), 
              plot.title = element_text(size = 18, face = 'bold', hjust = 0.5)) + xlim(0, 1)
```

\newpage
Este es el histograma resultante:
```{r, message = FALSE, warning = FALSE, fig.align = "center", fig.width = 5, fig.height = 4}
grafico_estadistico_histogram_density
```

\newpage
# 5. Evaluación de la Media Muestral
## 5.1 Tabla de Medidas 
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "450px", fig.align = "center", out.height = "400px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/MEDIDAS/medidasmediamuestral.png")
```
  
## Comparación con la varianza poblacional

```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "250px", fig.align = "center", out.height = "200px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/MEDIDAS/varianzamuestralpoblacional.png")
```

## 5.2 Histogramas
```{r, message = FALSE, warning = FALSE, fig.align = "center", fig.width = 5, fig.height = 4}
grafico_mediamuestral_histogram_density <- ggplot(data = datosgrafico, aes(x = mediamuestral)) + 
        geom_histogram(fill = "lightblue", color = "black", binwidth = 0.05) + 
        geom_density(size = 0.75, col = "blue") +
        ggtitle("Histograma de la Media Muestral") + 
        geom_vline(aes(xintercept = resultados[[5]]$Media, col = "Media Muestral"), linetype = "dashed", size = 1) +
        geom_vline(aes(xintercept = resultados$media_poblacional,  col = "Media Poblacional"), size = 1) + 
        scale_color_manual(name = "", values = c("Media Poblacional" = "black", "Media Muestral" = "red")) + 
        xlab("x") + ylab("f(x)") +
        theme(legend.position = "top",
              legend.text = element_text(size = 14),
              axis.text.x = element_text(size = 12),
              axis.text.y = element_text(size = 12),
              axis.title = element_text(size = 13, face = "bold"), 
              plot.title = element_text(size = 18, face = 'bold', hjust = 0.5)) + xlim(0, 1)
```
Con estos datos se confirmaría el que el valor de la esperanza de las medias muestrales es muy parecida a la media teórica. 
Como indica el coeficiente de curtosis, esta distribución es mesocúrtica (se parece mucho a una normal), y es muy simétrica pero tiene un poco de asimetría a la derecha, por lo que también la mediana se parece mucho a la media al ser una distribución centrada.
En cuanto a las medidas de dispersión, la desviación típica muestral (SD) es muy parecida a la teórica, y si el tamaño muestral aumentara se acercaría más. El IQR y la MAD son pequeños así que los valores centrales están muy concentrados en torno al centro, que en este caso está cerca de la media.
\newpage
Este es el gráfico resultante.
```{r, message = FALSE, warning = FALSE, fig.align = "center", fig.width = 5, fig.height = 4}
grafico_mediamuestral_histogram_density
```

\newpage
# 6. Comparando nuestro estadístico con la media muestral
## 6.1 Tabla de Medidas
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "450px", fig.align = "center", out.height = "400px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/MEDIDAS/medidascomparativa2.png")
```

## 6.2 Gráficos Comparativos
```{r, message = FALSE, warning = FALSE, fig.align = "center", fig.width = 5, fig.height = 4}
datos_grafico_comparativo <- gather(datosgrafico[, -1])
colnames(datos_grafico_comparativo) <- c("Estimador", "Valor")
datos_grafico_comparativo[, 1] <- gsub("mediamuestral", "Media Muestral", 
                                       datos_grafico_comparativo[, 1])
cutoff <- data.frame( yintercept = resultados$media_poblacional, 
                      cutoff = factor(50) )

grafico_comparativo_boxplot <- ggplot(data = datos_grafico_comparativo, 
                                      aes(x = Estimador, y = Valor, 
                                          fill = Estimador, 
                                          color = Estimador)) + 
        geom_boxplot(alpha = 0.5) + 
        geom_jitter() + 
        ggtitle("Diagrama de Caja: Estadístico vs Media Muestral") + 
        theme(legend.position = "none",
              legend.text = element_text(size = 14),
              axis.text.x = element_text(size = 12),
              axis.text.y = element_text(size = 12),
              axis.title = element_text(size = 13, face = "bold"), 
              plot.title = element_text(size = 18, face = 'bold', 
                                        hjust = 0.5)) 
```

\newpage
Ahora observamos los gráficos que hemos creado: 
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "350px", fig.align = "center", out.height = "350px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/PLOTS/boxplotcomparativo.png")
```

\newpage
Aquí tenim un altre gràfic
```{r, message = FALSE, warning = FALSE, include = TRUE, echo = FALSE, out.width = "450px", fig.align = "center", out.height = "550px"}
knitr::include_graphics("C:/Users/marct/OneDrive - Tecnocampus Mataro-Maresme/Documentos/UNI_ESTADISTICA/2o/PRIMER CUATRIMESTRE/INFERENCIA ESTADISTICA I/TRABAJOS/INFERENCIA-I/TRABAJO EMPIRICO/IMAGENES/PLOTS/graficocomparativo_density.png")
```
Como se puede apreciar por los boxplots de ambos, estadísticos y medias muestrales, ambas distribuciones aproximan bastante bien la media poblacional pero la distribución de las medias muestrales tiene bastante menos dispersión, por lo que podemos concluir que la media muestral es mejor estimador que la media entre el primer y el tercer cuartil de los datos.
también se puede apreciar en ambas distribuciones una gran cantidad de datos atípicos y datos lejanos al centro, que han sido consecuencia de generar los datos de nuestras muestras aleatoriamente.